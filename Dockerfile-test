# Test suite for abaco project.
# Image: abaco/testsuite

# inherit from the flaskbase iamge:
from tapis/flaskbase

RUN apt-get install python3-dev g++ -y

# install additional requirements for the service.
COPY actors/requirements.txt /home/tapis/requirements.txt
RUN pip3 install --upgrade pip
RUN pip3 install -r /home/tapis/requirements.txt
RUN pip3 install pytest ipython #locustio

# copy service source code
COPY configschema.json /home/tapis/configschema.json
COPY config-local.json /home/tapis/config.json

# create abaco.log file for logs
RUN mkdir -p /home/tapis/service/resources /home/tapis/runtime_files/logs /home/tapis/runtime_files/_abaco_results_sockets /home/tapis/runtime_files/_abaco_fifos /home/tapis/runtime_files
# create abaco.log file for logs
RUN touch /home/tapis/runtime_files/logs/service.log
COPY docs/specs/openapi_v3.yml /home/tapis/service/resources/openapi_v3.yml

COPY actors /home/tapis/actors
RUN chmod +x /home/tapis/actors/health_check.sh
COPY tests /home/tapis/tests
RUN chmod +x /home/tapis/tests/entry.sh

RUN chown -R tapis:tapis /home/tapis
USER tapis
ENV PYTHONPATH .:*:actors:actors/*
CMD ["./tests/entry.sh"]
#entrypoint ["/tests/entry.sh"]